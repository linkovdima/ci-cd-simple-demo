name: CI/CD Deployment Pipeline

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞
      uses: actions/checkout@v4
      
    - name: üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
      run: |
        echo "=== –ü–†–û–í–ï–†–ö–ê –§–ê–ô–õ–û–í ==="
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        if [ -f "index.html" ]; then
          echo "‚úÖ index.html –Ω–∞–π–¥–µ–Ω"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É HTML
          if grep -q "<!DOCTYPE html>" index.html; then
            echo "‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π DOCTYPE"
          else
            echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω DOCTYPE"
            exit 1
          fi
          
          if grep -q "<html" index.html && grep -q "</html>" index.html; then
            echo "‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML"
          else
            echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ–ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ HTML"
            exit 1
          fi
          
          # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–π–ª–µ
          lines=$(wc -l < index.html)
          echo "üìÑ index.html —Å–æ–¥–µ—Ä–∂–∏—Ç $lines —Å—Ç—Ä–æ–∫"
          
        else
          echo "‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: index.html –Ω–µ –Ω–∞–π–¥–µ–Ω!"
          exit 1
        fi
        
        if [ -f "README.md" ]; then
          echo "‚úÖ README.md –Ω–∞–π–¥–µ–Ω"
        else
          echo "‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: README.md –Ω–µ –Ω–∞–π–¥–µ–Ω"
        fi
        
        echo "=== –ü–†–û–í–ï–†–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê ==="
        
    - name: üìù –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–±–æ—Ä–∫–µ
      run: |
        echo "=== –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –°–ë–û–†–ö–ï ==="
        echo "–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏: $(date)"
        echo "–ê–≤—Ç–æ—Ä –∫–æ–º–º–∏—Ç–∞: ${{ github.actor }}"
        echo "–°–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞: ${{ github.event.head_commit.message }}"
        echo "–í–µ—Ç–∫–∞: ${{ github.ref }}"
        echo "========================"
        
        # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–±–æ—Ä–∫–µ
        echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–±–æ—Ä–∫–µ" > build-info.txt
        echo "-------------------" >> build-info.txt
        echo "–í—Ä–µ–º—è: $(date)" >> build-info.txt
        echo "–ö–æ–º–º–∏—Ç: ${{ github.sha }}" >> build-info.txt
        echo "–ê–≤—Ç–æ—Ä: ${{ github.actor }}" >> build-info.txt
        echo "–í–µ—Ä—Å–∏—è: 1.0.0" >> build-info.txt
        
    - name: üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Å–±–æ—Ä–∫–∏
      run: |
        echo "=== –°–û–ó–î–ê–ù–ò–ï –ê–†–•–ò–í–ê ==="
        
        # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
        mkdir -p dist
        
        # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã
        cp index.html dist/
        cp README.md dist/ 2>/dev/null || true
        cp build-info.txt dist/
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        echo "version: 1.0.0" > dist/config.yml
        echo "build_date: $(date)" >> dist/config.yml
        echo "deployment_target: github_pages" >> dist/config.yml
        
        # –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
        cd dist
        tar -czf ../build-artifact.tar.gz .
        cd ..
        
        echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: build-artifact.tar.gz"
        ls -lh build-artifact.tar.gz
        
    - name: üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ (–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
      uses: actions/upload-artifact@v4
      with:
        name: website-build
        path: |
          build-artifact.tar.gz
          build-info.txt
        
    - name: üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ GitHub Pages
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        enable_jekyll: false
        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
        keep_files: false
        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ email –¥–ª—è –∫–æ–º–º–∏—Ç–æ–≤
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
        
    - name: ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
      if: success()
      run: |
        echo "üéâ –ü–∞–π–ø–ª–∞–π–Ω —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!"
        echo "üåê –°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
        echo "https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±–æ—Ä–∫–∏:"
        echo "- –í—Ä–µ–º—è: $(date)"
        echo "- –ö–æ–º–º–∏—Ç: ${{ github.sha }}"
        echo "- –í–µ—Ç–∫–∞: ${{ github.ref }}"
        
    - name: ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
      if: failure()
      run: |
        echo "‚ö†Ô∏è  –ü–∞–π–ø–ª–∞–π–Ω –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π!"
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã."
        echo ""
        echo "üõ†Ô∏è  –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:"
        echo "1. –û—à–∏–±–∫–∞ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ HTML"
        echo "2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
        echo "3. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞"