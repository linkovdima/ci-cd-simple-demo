name: Simple CI/CD Pipeline

on:
  push:
    branches: [ main, master ]

permissions:
  contents: write  # Ð­Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð² gh-pages Ð²ÐµÑ‚ÐºÑƒ

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð²
        
    - name: ðŸ” File validation
      run: |
        echo "=== FILE VALIDATION ==="
        echo "Current directory: $(pwd)"
        echo "Files in repository:"
        ls -la
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ index.html
        if [ ! -f "index.html" ]; then
          echo "âŒ ERROR: index.html not found!"
          echo "Creating a simple index.html file..."
          cat > index.html << 'HTML_EOF'
<!DOCTYPE html>
<html>
<head>
    <title>CI/CD Demo - Auto Generated</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ CI/CD Pipeline Working!</h1>
        <p>This page was auto-generated by GitHub Actions</p>
        <p>Build time: <span id="time">$(date)</span></p>
        <p>Commit: ${{ github.sha }}</p>
    </div>
</body>
</html>
HTML_EOF
        fi
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ HTML
        echo "Checking index.html..."
        if [ -f "index.html" ]; then
          echo "âœ… index.html exists"
          echo "First 5 lines of index.html:"
          head -5 index.html
        fi
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ README ÐµÑÐ»Ð¸ Ð½ÐµÑ‚
        if [ ! -f "README.md" ]; then
          echo "Creating README.md..."
          cat > README.md << 'README_EOF'
# CI/CD Demo Project

This is a demonstration of CI/CD pipeline with GitHub Actions.

## What this pipeline does:
1. Validates files on every push
2. Deploys automatically to GitHub Pages

## Files:
- `index.html` - Main website file
- `.github/workflows/deploy.yml` - CI/CD configuration

## Website URL:
https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/
README_EOF
        fi
        
    - name: ðŸ“Š Build information
      run: |
        echo "=== BUILD INFO ==="
        echo "Build started at: $(date)"
        echo "Repository: ${{ github.repository }}"
        echo "Branch: ${{ github.ref }}"
        echo "Commit: ${{ github.sha }}"
        echo "Triggered by: ${{ github.actor }}"
        
        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ„Ð°Ð¹Ð» Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹ Ð¾ ÑÐ±Ð¾Ñ€ÐºÐµ
        cat > build-info.json << EOF
{
  "build": {
    "timestamp": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
    "repository": "${{ github.repository }}",
    "branch": "${{ github.ref_name }}",
    "commit": "${{ github.sha }}",
    "actor": "${{ github.actor }}",
    "run_id": "${{ github.run_id }}",
    "run_number": "${{ github.run_number }}"
  }
}
EOF
        
        echo "Build info saved to build-info.json"
        cat build-info.json
        
    - name: ðŸš€ Deploy to GitHub Pages
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages
        folder: .
        clean: true
        single-commit: true
        
    - name: âœ… Success notification
      if: success()
      run: |
        echo ""
        echo "ðŸŽ‰ CI/CD PIPELINE SUCCESSFUL!"
        echo "=============================="
        echo "Your site will be available at:"
        echo "ðŸ‘‰ https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "To view the deployment:"
        echo "1. Go to your repository Settings"
        echo "2. Click 'Pages' in the left menu"
        echo "3. Wait 1-2 minutes for deployment"
        
    - name: ðŸ“¦ Upload artifacts (optional)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: build-output
        path: |
          index.html
          README.md
          build-info.json